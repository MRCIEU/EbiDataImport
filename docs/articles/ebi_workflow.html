<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="GwasDataImport">
<title>EBI upload pipeline • GwasDataImport</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.11/clipboard.min.js" integrity="sha512-7O5pXpc0oCRrxk8RUfDYFgn0nO1t+jLuIOQdOMRp4APB7uZ4vSjspzp5y6YDtDs4VzUSTbWzBFZ/LKJhnyFOKw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="EBI upload pipeline">
<meta property="og:description" content="GwasDataImport">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light" data-bs-theme="light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">GwasDataImport</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.2</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-vignettes">Vignettes</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-vignettes">
    <a class="dropdown-item" href="../articles/index.html">List of vignettes</a>
    <a class="dropdown-item" href="../articles/import_pipeline.html">Importing datasets into OpenGWAS</a>
    <a class="dropdown-item" href="../articles/edit.html">Edit existing GWAS meta data</a>
    <a class="dropdown-item" href="../articles/ebi_workflow.html">EBI upload pipeline</a>
    <a class="dropdown-item" href="../articles/liftover.html">Automating liftover</a>
    <a class="dropdown-item" href="../articles/testrun.html">Test run for upload system</a>
    <a class="dropdown-item" href="../articles/get_positions.html">Looking up chromosome and position for large sets of rs IDs</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Functions</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/mrcieu/GwasDataImport">Source</a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>EBI upload pipeline</h1>
            
      
      
      <div class="d-none name"><code>ebi_workflow.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">GwasDataImport</span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="objectives">Objectives<a class="anchor" aria-label="anchor" href="#objectives"></a>
</h2>
<ol style="list-style-type: decimal">
<li>Download and format the data and metadata for an EBI dataset</li>
<li>Upload the formatted EBI data and metadata to OpenGWAS API</li>
<li>Determine which datasets in EBI are not present in OpenGWAS. Allow a
‘blacklist’ of EBI datasets to ignore. (TODO)</li>
</ol>
</div>
<div class="section level2">
<h2 id="complete-workflow-for-one-dataset">Complete workflow for one dataset<a class="anchor" aria-label="anchor" href="#complete-workflow-for-one-dataset"></a>
</h2>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># library(devtools)</span></span>
<span><span class="co"># load_all()</span></span>
<span><span class="co"># ieugwasr::select_api("dev2")</span></span>
<span></span>
<span><span class="co"># Authorise</span></span>
<span><span class="fu">ieugwasr</span><span class="fu">::</span><span class="fu">get_access_token</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># This is a small file, good for testing</span></span>
<span><span class="va">ebi_id</span> <span class="op">&lt;-</span> <span class="st">"GCST005522"</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/EbiDataset.html">EbiDataset</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span></span>
<span>    ebi_id <span class="op">=</span> <span class="va">ebi_id</span>, </span>
<span>    ftp_path <span class="op">=</span> <span class="fu"><a href="../reference/get_ftp_path.html">get_ftp_path</a></span><span class="op">(</span><span class="va">ebi_id</span><span class="op">)</span>,</span>
<span>    igd_id <span class="op">=</span> <span class="st">"ebi-a-EBITEST"</span>,</span>
<span>    wd <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"uploads/"</span>, <span class="va">ebi_id</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">x</span><span class="op">$</span><span class="fu">pipeline</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>Now delete:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span><span class="op">$</span><span class="fu">api_gwasdata_delete</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="running-each-step-individually">Running each step individually<a class="anchor" aria-label="anchor" href="#running-each-step-individually"></a>
</h2>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ebi_id</span> <span class="op">&lt;-</span> <span class="st">"GCST005522"</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/EbiDataset.html">EbiDataset</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span></span>
<span>    ebi_id <span class="op">=</span> <span class="va">ebi_id</span>, </span>
<span>    ftp_path <span class="op">=</span> <span class="fu"><a href="../reference/get_ftp_path.html">get_ftp_path</a></span><span class="op">(</span><span class="va">ebi_id</span><span class="op">)</span>,</span>
<span>    igd_id <span class="op">=</span> <span class="st">"ebi-a-EBITEST"</span>,</span>
<span>    wd <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"uploads/"</span>, <span class="va">ebi_id</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">x</span><span class="op">$</span><span class="fu">download_dataset</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">x</span><span class="op">$</span><span class="fu">format_ebi_dataset</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">x</span><span class="op">$</span><span class="fu">determine_columns</span><span class="op">(</span>params<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>chr_col<span class="op">=</span><span class="fl">1</span>, snp_col<span class="op">=</span><span class="fl">2</span>, pos_col<span class="op">=</span><span class="fl">3</span>, oa_col<span class="op">=</span><span class="fl">4</span>, ea_col<span class="op">=</span><span class="fl">5</span>, eaf_col<span class="op">=</span><span class="fl">6</span>, beta_col<span class="op">=</span><span class="fl">7</span>, se_col<span class="op">=</span><span class="fl">8</span>, pval_col<span class="op">=</span><span class="fl">9</span><span class="op">)</span>, gwas_file<span class="op">=</span><span class="va">x</span><span class="op">$</span><span class="va">gwas_out1</span><span class="op">)</span></span>
<span><span class="va">x</span><span class="op">$</span><span class="fu">format_dataset</span><span class="op">(</span>gwas_file<span class="op">=</span><span class="va">x</span><span class="op">$</span><span class="va">gwas_out1</span><span class="op">)</span></span>
<span><span class="va">x</span><span class="op">$</span><span class="fu">organise_metadata</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">x</span><span class="op">$</span><span class="fu">api_metadata_upload</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">x</span><span class="op">$</span><span class="fu">api_gwasdata_upload</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">x</span><span class="op">$</span><span class="fu">api_gwasdata_delete</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="workflow-for-all-datasets">Workflow for all datasets<a class="anchor" aria-label="anchor" href="#workflow-for-all-datasets"></a>
</h2>
<p>To get a list of datasets that need to be imported:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ignore_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/scan.html" class="external-link">scan</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span>package<span class="op">=</span><span class="st">"EbiDataImport"</span>, <span class="st">"extdata/ebi_ignore_list.txt"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">character</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">newdats</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/determine_new_datasets.html">determine_new_datasets</a></span><span class="op">(</span>blacklist<span class="op">=</span><span class="va">ignore_list</span><span class="op">)</span></span>
<span><span class="va">newdats</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/being_processed.html">being_processed</a></span><span class="op">(</span><span class="va">newdats</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">.</span>, <span class="va">need</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ignore</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">2</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">newdats</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="va">newdats</span><span class="op">$</span><span class="va">ebi_id</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span></span>
<span>    <span class="va">x</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/EbiDataset.html">EbiDataset</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span></span>
<span>        ebi_id <span class="op">=</span> <span class="va">newdats</span><span class="op">$</span><span class="va">ebi_id</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, </span>
<span>        ftp_path <span class="op">=</span> <span class="va">newdats</span><span class="op">$</span><span class="va">path</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>,</span>
<span>        wd <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"uploads/"</span>, <span class="va">newdats</span><span class="op">$</span><span class="va">ebi_id</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>    <span class="va">o</span> <span class="op">&lt;-</span> <span class="va">x</span><span class="op">$</span><span class="fu">pipeline</span><span class="op">(</span><span class="op">)</span></span>
<span>    <span class="kw">if</span><span class="op">(</span><span class="op">!</span> <span class="st">"NULL"</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">o</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">{</span></span>
<span>        <span class="va">ignore</span><span class="op">[[</span><span class="va">newdats</span><span class="op">$</span><span class="va">ebi_id</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">o</span></span>
<span>    <span class="op">}</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/rm.html" class="external-link">rm</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="lookup-build">Lookup build<a class="anchor" aria-label="anchor" href="#lookup-build"></a>
</h2>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/EbiDataset.html">EbiDataset</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="st">"GCST000755"</span>, ftp_path<span class="op">=</span><span class="fu"><a href="../reference/get_ftp_path.html">get_ftp_path</a></span><span class="op">(</span><span class="st">"GCST000755"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">x</span><span class="op">$</span><span class="fu">download_dataset</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">x</span><span class="op">$</span><span class="fu">format_dataset</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="suhre-proteins">Suhre proteins<a class="anchor" aria-label="anchor" href="#suhre-proteins"></a>
</h2>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ignore_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/scan.html" class="external-link">scan</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span>package<span class="op">=</span><span class="st">"EbiDataImport"</span>, <span class="st">"extdata/ebi_ignore_list.txt"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">character</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">newdats</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/determine_new_datasets.html">determine_new_datasets</a></span><span class="op">(</span>blacklist<span class="op">=</span><span class="va">ignore_list</span>, exclude <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">suhre</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">newdats</span>, <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"Suhr"</span>, <span class="va">path</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">suhre</span> <span class="op">&lt;-</span> <span class="fu">separate</span><span class="op">(</span><span class="va">suhre</span>, <span class="va">path</span>, sep<span class="op">=</span><span class="st">"/"</span>, into<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"p1"</span>,<span class="st">"p2"</span>,<span class="st">"p3"</span><span class="op">)</span>, remove<span class="op">=</span><span class="cn">F</span><span class="op">)</span></span>
<span><span class="va">temp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">rbind</span>, <span class="fu"><a href="https://rdrr.io/r/base/strsplit.html" class="external-link">strsplit</a></span><span class="op">(</span><span class="va">suhre</span><span class="op">$</span><span class="va">p3</span>, split<span class="op">=</span><span class="st">"_"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">suhre</span><span class="op">$</span><span class="va">igd_id</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"prot-c-"</span>, <span class="va">temp</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>, <span class="st">"_"</span>, <span class="va">temp</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">suhre</span><span class="op">$</span><span class="va">igd_id</span></span>
<span></span>
<span><span class="va">traitinfo</span> <span class="op">&lt;-</span> <span class="fu">data.table</span><span class="fu">::</span><span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/fread.html" class="external-link">fread</a></span><span class="op">(</span><span class="st">"http://metabolomics.helmholtz-muenchen.de/pgwas/download/probeanno.tsv"</span>, sep<span class="op">=</span><span class="st">"\t"</span><span class="op">)</span></span>
<span><span class="va">traitinfo</span><span class="op">$</span><span class="va">igd_id</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"prot-c-"</span>, <span class="va">traitinfo</span><span class="op">$</span><span class="va">seqid</span><span class="op">)</span></span>
<span></span>
<span><span class="va">suhre</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/merge.html" class="external-link">merge</a></span><span class="op">(</span><span class="va">suhre</span>, <span class="va">traitinfo</span>, by<span class="op">=</span><span class="st">"igd_id"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/save.html" class="external-link">save</a></span><span class="op">(</span><span class="va">suhre</span>, file<span class="op">=</span><span class="st">"suhre.rdata"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/load.html" class="external-link">load</a></span><span class="op">(</span><span class="st">"suhre.rdata"</span><span class="op">)</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">suhre</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">{</span></span>
<span>    <span class="va">x</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/EbiDataset.html">EbiDataset</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span></span>
<span>        ebi_id<span class="op">=</span><span class="va">suhre</span><span class="op">$</span><span class="va">ebi_id</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>,</span>
<span>        ftp_path<span class="op">=</span><span class="va">suhre</span><span class="op">$</span><span class="va">path</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>,</span>
<span>        igd_id<span class="op">=</span><span class="va">suhre</span><span class="op">$</span><span class="va">igd_id</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>,</span>
<span>        traitname<span class="op">=</span><span class="va">suhre</span><span class="op">$</span><span class="va">target</span><span class="op">[</span><span class="va">i</span><span class="op">]</span></span>
<span>    <span class="op">)</span></span>
<span>    <span class="va">x</span><span class="op">$</span><span class="fu">download_dataset</span><span class="op">(</span><span class="op">)</span></span>
<span>    <span class="va">x</span><span class="op">$</span><span class="fu">pipeline</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Conclusion - they seem to be missing standard errors? Need to do this
through the batch processing.</p>
</div>
<div class="section level2">
<h2 id="ebi-ignore-list">EBI Ignore list<a class="anchor" aria-label="anchor" href="#ebi-ignore-list"></a>
</h2>
<p>Need to figure out a solution for storing this. Many EBI datasets
don’t have sufficient info to be included, so we need to ignore them
instead of trying to upload them each time we look for new studies.</p>
<p>On the <code>ieu-ssd</code> machine where the original set of EBI
datasets was downloaded and processed, this is how the first ignore list
was determined:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="va">a</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span><span class="st">"/data/ebi_gwascatalog/pmids.txt"</span><span class="op">)</span></span>
<span><span class="va">b</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/scan.html" class="external-link">scan</a></span><span class="op">(</span><span class="st">"/data/ebi_gwascatalog/study_ids.txt"</span>, <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">character</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">got</span> <span class="op">&lt;-</span> <span class="fu">ieugwasr</span><span class="fu">::</span><span class="fu"><a href="https://mrcieu.github.io/ieugwasr/reference/gwasinfo.html" class="external-link">gwasinfo</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">.</span>, <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"ebi-a"</span>, <span class="va">id</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="op">{</span><span class="va">.</span><span class="op">$</span><span class="va">id</span><span class="op">}</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">"ebi-a-"</span>, <span class="st">""</span>, <span class="va">.</span><span class="op">)</span></span>
<span><span class="va">a</span><span class="op">$</span><span class="va">got</span> <span class="op">&lt;-</span> <span class="va">a</span><span class="op">$</span><span class="va">StudyID</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">got</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">a</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">a</span><span class="op">$</span><span class="va">got</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">a</span><span class="op">$</span><span class="va">got</span>, <span class="va">a</span><span class="op">$</span><span class="va">Status</span><span class="op">)</span></span>
<span><span class="va">ebi_ignore_list</span> <span class="op">&lt;-</span> <span class="va">a</span><span class="op">$</span><span class="va">StudyID</span><span class="op">[</span><span class="va">a</span><span class="op">$</span><span class="va">Status</span> <span class="op">==</span> <span class="st">"harmonised"</span> <span class="op">&amp;</span> <span class="op">!</span><span class="va">a</span><span class="op">$</span><span class="va">got</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/write.table.html" class="external-link">write.table</a></span><span class="op">(</span><span class="va">ebi_ignore_list</span>, file<span class="op">=</span><span class="st">"ebi_ignore_list.txt"</span>, row<span class="op">=</span><span class="cn">F</span>, col<span class="op">=</span><span class="cn">F</span>, qu<span class="op">=</span><span class="cn">F</span><span class="op">)</span></span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Gibran Hemani, Philip Haycock, Tom Palmer.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
